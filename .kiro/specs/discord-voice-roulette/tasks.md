# 実装計画: Discord ボイスルーレット

## 概要

Discord API を利用してボイスチャネルのメンバーから指定人数をランダムに選出する、完全クライアントサイドの Web アプリケーションを実装します。GitHub Pages での静的ホスティングを前提とし、Vanilla JavaScript で実装します。

## タスク

- [x] 1. プロジェクト構造とコア設定のセットアップ
  - プロジェクトのディレクトリ構造を作成
  - Discord アプリケーション設定ファイル（config.js）を作成
  - 基本的な HTML テンプレート（index.html、callback.html）を作成
  - CSS ファイルの基本構造を作成
  - テストフレームワーク（Jest、fast-check）のセットアップ
  - _要件: 5.1, 5.2_

- [ ] 2. 認証モジュール（AuthModule）の実装
  - [x] 2.1 AuthModule クラスの実装
    - OAuth2 認証フロー開始機能を実装
    - 認証コールバック処理とトークン交換を実装
    - トークンの保存・取得・削除機能を実装
    - 認証状態の確認機能を実装
    - _要件: 1.1, 1.2, 7.1, 7.3_

  - [ ]* 2.2 AuthModule のプロパティテストを作成
    - **プロパティ 1: 認証成功時のトークン保存**
    - **検証: 要件 1.2, 1.3, 7.1**

  - [ ]* 2.3 AuthModule のユニットテストを作成
    - ログアウト時の認証情報削除をテスト
    - 認証状態確認機能をテスト
    - エッジケース（無効なトークン、ストレージエラー）をテスト
    - _要件: 7.3_

- [ ] 3. Discord API クライアント（DiscordClient）の実装
  - [x] 3.1 DiscordClient クラスの実装
    - コンストラクタとトークン管理を実装
    - 汎用 API リクエストメソッドを実装
    - レート制限処理を実装
    - エラーハンドリングを実装
    - _要件: 8.1, 8.2, 8.3_

  - [x] 3.2 ギルドとチャネル取得機能の実装
    - getGuilds メソッドを実装
    - getChannels メソッドを実装
    - ボイスチャネルのフィルタリングを実装
    - _要件: 1.3, 1.4_

  - [x] 3.3 ボイスチャネルメンバー取得機能の実装
    - getVoiceChannelMembers メソッドを実装
    - メンバー情報の整形処理を実装
    - _要件: 2.1, 2.2_

  - [ ]* 3.4 DiscordClient のプロパティテストを作成
    - **プロパティ 2: サーバー選択時のチャネルリスト取得**
    - **プロパティ 3: チャネル選択時のメンバーリスト取得**
    - **プロパティ 10: API エラーハンドリング**
    - **検証: 要件 1.4, 2.1, 2.2, 8.1, 8.2**

  - [ ]* 3.5 DiscordClient のユニットテストを作成
    - レート制限エラー時の待機時間処理をテスト
    - ネットワークエラー時の再試行オプションをテスト
    - 認証エラー時のエラーメッセージをテスト
    - _要件: 8.1, 8.2, 8.3_

- [ ] 4. チェックポイント - コア API 機能の確認
  - すべてのテストが通過することを確認
  - 質問があればユーザーに確認

- [ ] 5. ルーレットエンジン（RouletteEngine）の実装
  - [x] 5.1 RouletteEngine クラスの実装
    - Fisher-Yates シャッフルアルゴリズムを実装
    - selectMembers メソッドを実装
    - validateCount メソッドを実装
    - _要件: 3.1, 3.2, 3.3, 3.4_

  - [ ]* 5.2 RouletteEngine のプロパティテストを作成
    - **プロパティ 4: 選出人数のバリデーション**
    - **プロパティ 5: ルーレット選出の正確性**
    - **プロパティ 6: 選出確率の均等性**
    - **検証: 要件 3.1, 3.2, 3.3, 3.4**

  - [ ]* 5.3 RouletteEngine のユニットテストを作成
    - メンバーが 1 人の場合のテスト
    - 全員を選出する場合のテスト
    - 無効な選出人数（0、負の数、超過）のテスト
    - _要件: 3.1, 3.2_

- [ ] 6. UI コントローラー（UIController）の実装
  - [x] 6.1 UIController クラスの基本実装
    - 画面遷移管理機能を実装
    - ローディング表示機能を実装
    - エラーメッセージ表示機能を実装
    - 成功メッセージ表示機能を実装
    - _要件: 6.2, 8.1_

  - [x] 6.2 各画面の表示機能を実装
    - 認証画面（showAuthScreen）を実装
    - ギルド選択画面（showGuildSelection）を実装
    - チャネル選択画面（showChannelSelection）を実装
    - ルーレット画面（showRouletteScreen）を実装
    - 結果表示画面（showResults）を実装
    - _要件: 1.1, 1.4, 2.1, 4.1_

  - [x] 6.3 ルーレットアニメーション機能を実装
    - animateRoulette メソッドを実装
    - CSS アニメーションを定義
    - _要件: 3.5_

  - [ ]* 6.4 UIController のプロパティテストを作成
    - **プロパティ 7: 結果表示の完全性**
    - **プロパティ 13: ユーザーフィードバックの提供**
    - **検証: 要件 4.1, 4.2, 6.2**

  - [ ]* 6.5 UIController のユニットテストを作成
    - 各画面遷移のテスト
    - エラーメッセージ表示のテスト
    - ローディング表示のテスト
    - _要件: 6.2, 8.1_

- [ ] 7. 結果管理機能の実装
  - [x] 7.1 結果のクリップボードコピー機能を実装
    - クリップボード API を使用したコピー機能を実装
    - コピー成功/失敗のフィードバックを実装
    - _要件: 4.4_

  - [x] 7.2 ルーレット履歴機能を実装
    - 履歴の保存機能（ローカルストレージ）を実装
    - 履歴の取得・表示機能を実装
    - 履歴のクリア機能を実装
    - _要件: 4.5_

  - [ ]* 7.3 結果管理機能のプロパティテストを作成
    - **プロパティ 8: クリップボードコピー機能**
    - **プロパティ 9: 履歴保存と取得**
    - **検証: 要件 4.4, 4.5**

  - [ ]* 7.4 結果管理機能のユニットテストを作成
    - クリップボードコピーのエラーハンドリングをテスト
    - 履歴の保存・取得・削除をテスト
    - _要件: 4.4, 4.5_

- [ ] 8. チェックポイント - コア機能の確認
  - すべてのテストが通過することを確認
  - 質問があればユーザーに確認

- [ ] 9. アプリケーションコントローラー（AppController）の実装
  - [x] 9.1 AppController クラスの実装
    - コンストラクタと各モジュールの初期化を実装
    - initialize メソッドを実装
    - 認証フロー処理（startAuth、handleCallback）を実装
    - _要件: 1.1, 1.2, 1.5_

  - [x] 9.2 イベントハンドラーの実装
    - ギルド選択ハンドラー（handleGuildSelection）を実装
    - チャネル選択ハンドラー（handleChannelSelection）を実装
    - ルーレット実行ハンドラー（handleRouletteExecution）を実装
    - ログアウトハンドラー（handleLogout）を実装
    - _要件: 1.4, 2.1, 3.3, 7.3_

  - [ ]* 9.3 AppController の統合テストを作成
    - エンドツーエンドフローのテスト
    - エラーハンドリングの統合テスト
    - _要件: 1.1, 1.4, 2.1, 3.3_

- [ ] 10. UI スタイリングとレスポンシブデザインの実装
  - [x] 10.1 基本スタイルの実装
    - CSS 変数とカラースキームを定義
    - タイポグラフィとレイアウトの基本スタイルを実装
    - ボタン、入力フィールド、カードコンポーネントのスタイルを実装
    - _要件: 6.1_

  - [x] 10.2 レスポンシブデザインの実装
    - モバイル向けのメディアクエリを実装
    - タブレット向けのメディアクエリを実装
    - タッチ操作に適したボタンサイズを設定
    - _要件: 6.1_

  - [x] 10.3 アニメーション効果の実装
    - ルーレットアニメーションの CSS を実装
    - 画面遷移のトランジション効果を実装
    - ローディングスピナーのアニメーションを実装
    - _要件: 3.5_

- [ ] 11. アクセシビリティとユーザーガイダンスの実装
  - [ ] 11.1 アクセシビリティ対応
    - ARIA ラベルとロールを追加
    - キーボードナビゲーションのサポートを実装
    - フォーカス管理を実装
    - _要件: 6.4_

  - [ ] 11.2 ユーザーガイダンスの実装
    - 初回利用時のガイド表示機能を実装
    - ツールチップとヘルプテキストを追加
    - エラーメッセージの改善
    - _要件: 8.4, 8.5_

- [ ] 12. エラーハンドリングの統合と改善
  - [ ] 12.1 包括的なエラーハンドリングを実装
    - すべてのモジュールでエラーハンドリングを統一
    - ユーザーフレンドリーなエラーメッセージを実装
    - エラーログ機能を実装（開発環境用）
    - _要件: 8.1, 8.2, 8.3_

  - [ ]* 12.2 エラーハンドリングのプロパティテストを作成
    - **プロパティ 11: レート制限処理**
    - **プロパティ 12: ログアウト時の認証情報削除**
    - **検証: 要件 7.3, 8.3**

- [ ] 13. 最終統合とワイヤリング
  - [x] 13.1 すべてのモジュールを統合
    - index.html でアプリケーションを初期化
    - callback.html で OAuth2 コールバックを処理
    - すべてのイベントリスナーを接続
    - _要件: 1.1, 1.2_

  - [ ] 13.2 設定ファイルの最終調整
    - Discord Client ID の設定
    - リダイレクト URI の設定
    - 必要な API スコープの確認
    - _要件: 5.5, 7.4, 7.5_

  - [ ]* 13.3 統合テストの実行
    - すべてのプロパティテストを実行
    - すべてのユニットテストを実行
    - テストカバレッジを確認（目標: 80%以上）

- [ ] 14. ドキュメントとデプロイメント準備
  - [ ] 14.1 README.md の作成
    - プロジェクト概要を記述
    - セットアップ手順を記述
    - Discord アプリケーション設定手順を記述
    - 使用方法を記述
    - _要件: 5.3, 5.5_

  - [ ] 14.2 GitHub Pages デプロイメント設定
    - リポジトリ設定の確認
    - デプロイメント手順のドキュメント作成
    - _要件: 5.3_

- [ ] 15. 最終チェックポイント
  - すべてのテストが通過することを確認
  - すべての要件が実装されていることを確認
  - ユーザーに最終確認を依頼

## 注意事項

- `*` マークが付いたタスクはオプションであり、より迅速な MVP のためにスキップ可能です
- 各タスクは特定の要件を参照しており、トレーサビリティを確保しています
- チェックポイントタスクは段階的な検証を保証します
- プロパティテストは普遍的な正確性プロパティを検証します
- ユニットテストは特定の例とエッジケースを検証します
