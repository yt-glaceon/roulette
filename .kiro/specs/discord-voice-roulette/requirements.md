# 要件定義書

## はじめに

本システムは、Discord のボイスチャネルに参加しているメンバーから指定人数をランダムに選出するルーレットアプリケーションです。GitHub Pages で静的サイトとして公開され、ユーザーフレンドリーな UI を通じてルーレット結果を表示します。

## 用語集

- **System**: Discord ボイスルーレットアプリケーション全体
- **Discord_API**: Discord が提供する公式 API
- **Voice_Channel**: Discord のボイスチャネル
- **Member_List**: ボイスチャネルに参加しているメンバーのリスト
- **Roulette**: メンバーリストから指定人数をランダムに選出する機能
- **UI**: ユーザーインターフェース
- **GitHub_Pages**: GitHub が提供する静的サイトホスティングサービス

## 要件

### 要件 1: Discord 認証とボイスチャネル情報の取得

**ユーザーストーリー:** ユーザーとして、Discord アカウントで認証し、自分がアクセス可能なボイスチャネルの情報を取得したい。これにより、ルーレット対象のチャネルを選択できるようになる。

#### 受入基準

1. WHEN ユーザーが認証ボタンをクリックする THEN THE System SHALL Discord OAuth2 フローを開始する
2. WHEN Discord 認証が成功する THEN THE System SHALL アクセストークンを安全に保存する
3. WHEN 認証が完了する THEN THE System SHALL ユーザーがアクセス可能なサーバー（ギルド）リストを取得する
4. WHEN ユーザーがサーバーを選択する THEN THE System SHALL そのサーバー内のボイスチャネルリストを表示する
5. IF 認証に失敗する THEN THE System SHALL エラーメッセージを表示し、再試行オプションを提供する

### 要件 2: ボイスチャネルメンバーリストの取得

**ユーザーストーリー:** ユーザーとして、選択したボイスチャネルに現在参加しているメンバーのリストを取得したい。これにより、ルーレットの対象者を確認できる。

#### 受入基準

1. WHEN ユーザーがボイスチャネルを選択する THEN THE System SHALL そのチャネルに参加している全メンバーのリストを取得する
2. WHEN メンバーリストを表示する THEN THE System SHALL 各メンバーの表示名とアバター画像を含める
3. WHEN ボイスチャネルにメンバーが存在しない THEN THE System SHALL 「メンバーがいません」というメッセージを表示する
4. WHEN メンバーリストの取得に失敗する THEN THE System SHALL エラーメッセージを表示し、再取得オプションを提供する
5. THE System SHALL メンバーリストをリアルタイムまたは手動更新で最新状態に保つ機能を提供する

### 要件 3: ルーレット実行機能

**ユーザーストーリー:** ユーザーとして、取得したメンバーリストから指定した人数をランダムに選出したい。これにより、公平な選出プロセスを実現できる。

#### 受入基準

1. WHEN ユーザーが選出人数を入力する THEN THE System SHALL 1 以上かつメンバー総数以下の整数値のみを受け付ける
2. WHEN 選出人数が無効な値である THEN THE System SHALL 入力を拒否し、有効な範囲を示すメッセージを表示する
3. WHEN ユーザーがルーレット開始ボタンをクリックする THEN THE System SHALL メンバーリストから指定人数をランダムに選出する
4. THE System SHALL 各メンバーが選出される確率を均等にする
5. WHEN ルーレットが実行される THEN THE System SHALL 視覚的なアニメーション効果を表示する

### 要件 4: ルーレット結果の表示

**ユーザーストーリー:** ユーザーとして、ルーレットの結果を視覚的にわかりやすく確認したい。これにより、選出されたメンバーを明確に把握できる。

#### 受入基準

1. WHEN ルーレットが完了する THEN THE System SHALL 選出されたメンバーのリストを表示する
2. WHEN 結果を表示する THEN THE System SHALL 各メンバーの表示名、アバター画像、選出順序を含める
3. THE System SHALL 選出されたメンバーと選出されなかったメンバーを視覚的に区別する
4. WHEN ユーザーが結果をコピーする THEN THE System SHALL 選出されたメンバー名をテキスト形式でクリップボードにコピーする機能を提供する
5. THE System SHALL ルーレット履歴を保持し、過去の結果を確認できる機能を提供する

### 要件 5: GitHub Pages での静的サイト公開

**ユーザーストーリー:** 開発者として、アプリケーションを GitHub Pages で公開したい。これにより、サーバーレスで低コストな運用を実現できる。

#### 受入基準

1. THE System SHALL 完全にクライアントサイドで動作する静的な Web アプリケーションとして実装される
2. THE System SHALL HTML、CSS、JavaScript のみで構成される
3. WHERE GitHub_Pages にデプロイされる THE System SHALL 正常に動作する
4. THE System SHALL サーバーサイドの処理を必要としない
5. THE System SHALL Discord OAuth2 のリダイレクト URI を GitHub Pages の URL に設定可能である

### 要件 6: ユーザーインターフェース

**ユーザーストーリー:** ユーザーとして、直感的で使いやすいインターフェースを通じてアプリケーションを操作したい。これにより、技術的な知識がなくても簡単に利用できる。

#### 受入基準

1. THE System SHALL レスポンシブデザインを採用し、モバイルデバイスでも利用可能である
2. WHEN ユーザーが操作を行う THEN THE System SHALL 適切なフィードバック（ローディング表示、成功/エラーメッセージ）を提供する
3. THE System SHALL 明確なナビゲーションフローを提供し、各ステップを順序立てて案内する
4. THE System SHALL アクセシビリティ基準（WCAG 2.1 レベル A）を考慮した実装を行う
5. WHEN ページが読み込まれる THEN THE System SHALL 3 秒以内に初期表示を完了する

### 要件 7: データの取り扱いとセキュリティ

**ユーザーストーリー:** ユーザーとして、自分の Discord アカウント情報が安全に取り扱われることを期待する。これにより、安心してアプリケーションを利用できる。

#### 受入基準

1. THE System SHALL Discord アクセストークンをブラウザのローカルストレージまたはセッションストレージに保存する
2. THE System SHALL アクセストークンを外部サーバーに送信しない
3. WHEN ユーザーがログアウトする THEN THE System SHALL 保存されたすべての認証情報を削除する
4. THE System SHALL 必要最小限の Discord API スコープのみを要求する
5. THE System SHALL HTTPS 経由でのみ Discord API と通信する

### 要件 8: エラーハンドリングとユーザーガイダンス

**ユーザーストーリー:** ユーザーとして、エラーが発生した際に何が問題で、どう対処すればよいかを理解したい。これにより、スムーズにアプリケーションを利用できる。

#### 受入基準

1. WHEN API 呼び出しが失敗する THEN THE System SHALL ユーザーフレンドリーなエラーメッセージを表示する
2. WHEN ネットワークエラーが発生する THEN THE System SHALL 再試行オプションを提供する
3. WHEN レート制限に達する THEN THE System SHALL 待機時間を表示し、自動的に再試行する
4. THE System SHALL 初回利用時に簡単な使い方ガイドを表示する
5. WHERE ユーザーが操作に迷う THE System SHALL ツールチップやヘルプテキストを提供する
